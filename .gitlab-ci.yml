---
#include:
#  - "https://gitlab.dune-project.org/core/ci-config/raw/master/config/common/master.yml"
#  - "https://gitlab.dune-project.org/core/ci-config/raw/master/jobs/common/master.yml"

before_script:
  - . /duneci/bin/duneci-init-job
  - duneci-install-module https://gitlab.dune-project.org/core/dune-common.git
  - duneci-install-module https://gitlab.dune-project.org/core/dune-geometry.git

.common: &common
  script:
    - duneci-standard-test
    - export DUNE_CONTROL_PATH=$(pwd):/duneci/modules:$DUNE_CONTROL_PATH
    - duneci-install-module https://gitlab.dune-project.org/core/dune-grid.git
    - cd /duneci/modules/dune-grid && duneci-standard-test
  tags: [duneci]
  artifacts:
    expire_in: 2 years
    reports:
      junit: junit/*.xml


# UG-specific job for testing sequential library version
debian:10 gcc-7-14 sequential:
  <<: *common
  image: registry.dune-project.org/docker/ci/debian:10
  variables:
    DUNECI_TOOLCHAIN: gcc-7-14
    DUNECI_CMAKE_FLAGS: "-DUG_ENABLE_PARALLEL=0"

debian:10 gcc-7-14 debug:
  <<: *common
  image: registry.dune-project.org/docker/ci/debian:10
  variables:
    DUNECI_TOOLCHAIN: gcc-7-14
    DUNECI_CMAKE_FLAGS: "-DDebug=1"
